# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Overview

Single-machine NixOS desktop configuration using Nix flakes. One host (`nixos`) running GNOME on x86_64-linux with nixpkgs-unstable.

## Common Commands

```bash
# Apply configuration changes
sudo nixos-rebuild switch --flake /home/mtnptrsn/nixos-config#nixos

# Test without making permanent (doesn't update bootloader)
sudo nixos-rebuild test --flake /home/mtnptrsn/nixos-config#nixos

# Build without activating (useful for checking if config compiles)
nix build /home/mtnptrsn/nixos-config#nixosConfigurations.nixos.config.system.build.toplevel

# Update nixpkgs input
nix flake update
```

## Architecture

- **flake.nix** — Entry point. Two inputs (nixpkgs-unstable, home-manager), single output (`nixosConfigurations.nixos`). Imports `configuration.nix` and wires Home Manager as a NixOS module.
- **configuration.nix** — System-level config: boot, networking, desktop environment, locale, audio, fonts, GPU, Steam, etc.
- **home.nix** — User-level config via Home Manager: packages, git, neovim, tmux, zsh, firefox, dconf/GNOME settings.
- **hardware-configuration.nix** — Auto-generated by `nixos-generate-config`. Do not edit manually.

## Key Details

- User account: `mtnptrsn` (wheel, networkmanager groups)
- Desktop: GNOME with GDM, X11
- Audio: PipeWire (with PulseAudio/ALSA compat)
- Locale: en_US.UTF-8 default, Swedish (sv_SE.UTF-8) for LC_* categories
- Keyboard: Swedish layout (`se`)
- `nixpkgs.config.allowUnfree = true`
- `system.stateVersion = "25.11"` — do not change without understanding migration implications

## Workflow

- Always apply configuration changes after editing by running `sudo nixos-rebuild switch --flake /home/mtnptrsn/nixos-config#nixos`

## Formatting and Linting

Before committing, always run the formatter and linter on all `.nix` files:

```bash
# Format all .nix files
nix run nixpkgs#nixfmt -- *.nix

# Lint all .nix files (check only)
nix run nixpkgs#statix -- check .
```

Fix any issues before committing. For statix, auto-fix is available with `nix run nixpkgs#statix -- fix .`.

## Git

- Do not add `Co-Authored-By` lines to commit messages
- When committing, separate changes into distinct commits by concern. Group related changes together and keep unrelated changes in separate commits.
